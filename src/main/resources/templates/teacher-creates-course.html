<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Teacher Courses</title>

	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">


	<link rel="stylesheet" th:href="@{/css/teacher-css/teacher-sidebar.css}">
	<link rel="stylesheet" th:href="@{/css/teacher-css/teacher-course.css}">
	<style>
		/* ================= BASE ================= */
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Poppins', sans-serif;
		}

		body {
			background: #f4f6f9;
			color: #1f1f2e;
		}

		/* ================= LAYOUT ================= */
		.main-content {
			margin-left: 260px;
			padding: 20px 30px;
			transition: margin-left 0.3s ease;
		}

		/* When sidebar is collapsed */
		body.sidebar-collapsed .main-content {
			margin-left: 10px;
		}
		.lesson-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Title input */
.lesson-title-input {
  width: 40%;
  min-width: 200px;
}

/* Type select */
.lesson-type-select {
  width: 140px;
}

/* Right-side buttons */
.lesson-actions {
  margin-left: auto;   /* MAGIC LINE */
  display: flex;
  gap: 10px;
}
	</style>
</head>

<body class="sidebar-collapsed">

	<!-- ===== SIDEBAR ===== -->
	<aside class="sidebar collapsed">
		<div class="sidebar-logo">
			<img th:src="@{/images/logo.png}" alt="EduPlatform Logo"> <span class="logo-text">EduPlatform</span>
		</div>


		<nav class="sidebar-menu">
			<a th:href="@{/teacher-dashboard}"><i class="bi bi-speedometer2"></i><span>Dashboard
				</span></a> <a th:href="@{/teacher-course}"><i class="bi bi-journal-text"></i><span>Course
					Management</span></a> <a th:href="@{/teacher-creates-course}" class="active"><i
					class="bi bi-journal-plus"></i><span>Create Course</span></a> <a th:href="@{/teacher-exams}"><i
					class="bi bi-pencil-square"></i><span>Exams
					& Quizzes</span></a> <a th:href="@{/teacher-students}"><i
					class="bi bi-people"></i><span>Students</span></a> <a th:href="@{/teacher-communication}"><i
					class="bi bi-chat-dots"></i><span>Communication</span></a>
			<a th:href="@{/teacher-feedback}"><i class="bi bi-star"></i><span>Feedback
					& Ratings</span></a> <a th:href="@{/teacher-profile}"><i
					class="bi bi-gear"></i><span>Profile</span></a> <a th:href="@{/logout}" class="logout"><i
					class="bi bi-box-arrow-right"></i><span>Logout</span></a>
		</nav>
	</aside>

	<!-- ===== MAIN CONTENT ===== -->
	<main class="main-content">
		<button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
		<div class="container">
			<form th:action="@{/teacher-creates-course}" th:object="${course}" method="post">
				<!-- HEADER -->
				<div class="page-header">
					<div class="page-title">
						<h3 th:text="${course.courseId == null ? 'Create Course' : 'Edit Course'}"></h3>
						<span class="draft-badge" th:text="${course.status != null ? course.status : 'DRAFT'}"></span>
					</div>
					<!-- <span class="draft-badge"
					th:text="${course.status != null ? course.status : 'DRAFT'}">
				</span> -->
				</div>

				<!-- STEPPER -->
				<div class="stepper">
					<div class="step active">Basic Info</div>
					<div class="step">Pricing</div>
					<div class="step">Curriculum & Content</div>
					<div class="step">Publish</div>
				</div>

				<!-- FLASH MESSAGES -->
				<div th:if="${success}" class="alert alert-success">
					<i class="bi bi-check-circle"></i>
					<span th:text="${success}"></span>
				</div>

				<div th:if="${error}" class="alert alert-danger">
					<i class="bi bi-exclamation-triangle"></i>
					<span th:text="${error}"></span>
				</div>
				<!-- BASIC INFO -->
				<div class="card">
					<h3>Course Details</h3>

					<div class="form-group">
						<label>Course Thumbnail</label>

						<div class="thumbnail-upload">
							<!-- Hidden file input -->
							<input type="file" id="thumbnailInput" accept="image/*" hidden>

							<!-- Clickable UI box -->
							<div class="thumbnail-preview" id="thumbnailPreview">
								<i class="bi bi-image"></i> <span>Upload thumbnail</span>
							</div>
						</div>

						<small> Recommended size: 1280 Ã— 720 (16:9). JPG or PNG. </small>
					</div>

					<input type="hidden" th:field="*{courseId}">

					<div class="form-group">
						<label>Course Title</label> <input type="text" placeholder="Spring Boot Masterclass"
							th:field="*{title}">
						<small>This will be shown publicly</small>
					</div>
					<div class="form-group">
						<label>Short Description</label>
						<textarea rows="3" placeholder="Learn Spring Boot with real projects"
							th:field="*{description}"></textarea>
					</div>

					<div class="form-group">
						<label>Category</label> <select th:field="*{level}">
							<option th:value="BEGINNER">Beginner</option>
							<option th:value="INTERMEDIATE">Intermediate</option>
							<option th:value="ADVANCED">Advanced</option>
						</select>
					</div>
				</div>

				<!-- PRICING -->
				<div class="card">
					<h3>Pricing</h3>
					<div class="form-group">
						<label>Course Type</label> <select th:field="*{type}" id="courseType">
							<option value="free">Free</option>
							<option value="paid">Paid</option>
						</select>
					</div>

					<div class="form-group" id="priceGroup">
						<label>Price (â‚¹)</label> <input type="number" placeholder="499" th:field="*{price}"
							id="priceInput"> <small>Only
							required for paid courses</small>
					</div>
				</div>
				<!-- SAVE & CONTINUE (FIRST TIME ONLY) -->
				<button type="submit" name="action" value="draft" class="btn btn-primary"
					th:if="${course.courseId == null}">
					Save & Continue</button>

			</form>
			<!-- CURRICULUM -->

			<!-- ================= CURRICULUM ================= -->
			<div th:if="${course.courseId != null}">
				<div class="card">
					<h3>Curriculum</h3>

					<!-- WHEN NO MODULES -->
					<div th:if="${course.modules == null or course.modules.empty}"
						style="padding: 20px; text-align: center; color: #666">
						<p>No modules yet.</p>
						<p>Start by adding your first module.</p>
					</div>

					<!-- MODULE LOOP -->
					<div th:each="module : ${course.modules}" class="module" th:id="'module-' + ${module.moduleId}"
						th:classappend="${openModule == module.moduleId} ? ' expanded' : ''">

						<!-- MODULE HEADER -->

						<div class="module-header">

							<!-- NORMAL MODE -->
							<div class="module-header-row"
								th:if="${editModule == null or editModule != module.moduleId}">

								<span th:text="${module.title}">Module title</span>

								<div class="module-actions">

									<!-- EDIT -->
									<a th:href="@{/teacher-creates-course(
                    courseId=${course.courseId},
                    editModule=${module.moduleId}
                )}" class="btn btn-outline"> Edit </a>

									<!-- ADD LESSON -->
									<form th:action="@{/teacher/lesson/add}" method="post">
										<input type="hidden" name="moduleId" th:value="${module.moduleId}">
										<button class="btn btn-outline">+ Lesson</button>
									</form>

									<!-- DELETE MODULE -->
									<form th:action="@{/teacher/module/delete}" method="post">
										<input type="hidden" name="moduleId" th:value="${module.moduleId}">
										<button class="btn btn-outline">ðŸ—‘</button>
									</form>

								</div>
							</div>

							<!-- EDIT MODE -->
							<div class="module-header-row" th:if="${editModule == module.moduleId}">

								<!-- SAVE -->
								<form th:action="@{/teacher/module/update}" method="post" class="module-edit-form">

									<input type="hidden" name="moduleId" th:value="${module.moduleId}"> <input
										type="text" name="title" th:value="${module.title}" class="module-title-input"
										placeholder="Module title">

									<button class="btn btn-outline">Save</button>
								</form>

								<div class="module-actions">

									<!-- CANCEL -->
									<a th:href="@{/teacher-creates-course(courseId=${course.courseId})}"
										class="btn btn-outline"> Cancel </a>

									<!-- DELETE MODULE -->
									<form th:action="@{/teacher/module/delete}" method="post">
										<input type="hidden" name="moduleId" th:value="${module.moduleId}">
										<button class="btn btn-outline">ðŸ—‘</button>
									</form>

								</div>
							</div>

						</div>

						<!-- LESSONS -->
						<div class="lessons">

							<div th:each="lesson : ${module.lessons}" class="lesson"
								th:id="'lesson-' + ${lesson.lessonId}"
								th:classappend="${openLesson == lesson.lessonId or openQuiz == lesson.lessonId} ? ' expanded' : ''">

								<!-- LESSON TITLE + TYPE -->
								<div class="lesson-header">
									<strong th:text="${lesson.title}">Lesson title</strong> <span class="badge"
										th:text="${lesson.type}">VIDEO</span>
								</div>

								<!-- UPDATE LESSON -->
								<form th:action="@{/teacher/lesson/update}" method="post" enctype="multipart/form-data"
									class="lesson-row">

									<input type="hidden" name="lessonId" th:value="${lesson.lessonId}">

									<!-- TITLE -->
									<input name="title" th:value="${lesson.title}" placeholder="Lesson title"
										class="lesson-title-input">

									<!-- TYPE -->
									<select name="type" class="lesson-type-select">
										<option value="VIDEO" th:selected="${lesson.type.name()=='VIDEO'}">Video
										</option>
										<option value="NOTES" th:selected="${lesson.type.name()=='NOTES'}">Notes
										</option>
										<option value="QUIZ" th:selected="${lesson.type.name()=='QUIZ'}">Quiz</option>
									</select>


									<!-- PUSH RIGHT -->
									<div class="lesson-actions">
										<button type="submit" class="btn btn-outline"
											th:formaction="@{/teacher/lesson/update}">
											Save
										</button>

										<button type="submit" class="btn btn-outline btn-danger"
											th:formaction="@{/teacher/lesson/delete}">
											ðŸ—‘ Delete Lesson
										</button>
									</div>
										</form>
									<!-- VIDEO -->
									<div th:if="${lesson.type.name()=='VIDEO'}" class="lesson-content">

										<div class="lesson-inline">
											<input type="hidden" name="lessonId" th:value="${lesson.lessonId}"> <input
												type="file" name="video"> <label class="free-preview"> <input
													type="checkbox" name="freePreview"
													th:checked="${lesson.freePreview}"> Free Preview
											</label> <span class="spacer"></span>


										</div>
									</div>
									<!-- NOTES -->
									<div th:if="${lesson.type.name()=='NOTES'}" class="lesson-content">
										<input type="hidden" name="lessonId" th:value="${lesson.lessonId}"> <input
											type="file" name="notes" accept="application/pdf"> <span
											class="spacer"></span>
									</div>
							
								<!-- QUIZ LESSON -->
								<!-- ================= QUIZ LESSON ================= -->
								<div th:if="${lesson.type.name() == 'QUIZ'}" class="lesson-content"
									th:id="'quiz-' + ${lesson.lessonId}">

									<!-- ================= SAVE QUIZ ================= -->
									<form th:action="@{/teacher/quiz/question/update}" method="post">

										<input type="hidden" name="lessonId" th:value="${lesson.lessonId}" />

										<div th:if="${lesson.quiz != null}">

											<div th:each="q : ${lesson.quiz.questions}" class="quiz-question">

												<input type="hidden" name="questionIds" th:value="${q.questionId}" />

												<!-- QUESTION -->
												<input name="questionTexts" th:value="${q.questionText}"
													placeholder="Question" required />

												<!-- OPTIONS -->
												<div class="quiz-options">
													<input name="optionAs" th:value="${q.optionA}"
														placeholder="Option A" required /> <input name="optionBs"
														th:value="${q.optionB}" placeholder="Option B" required />
													<input name="optionCs" th:value="${q.optionC}"
														placeholder="Option C" required /> <input name="optionDs"
														th:value="${q.optionD}" placeholder="Option D" required />
												</div>

												<!-- CORRECT ANSWER (SELECT, NOT RADIO) -->
												<select name="correctOptions" required>
													<option value="" disabled>Correct Answer</option>
													<option value="A" th:selected="${q.correctOption=='A'}">Option
														A</option>
													<option value="B" th:selected="${q.correctOption=='B'}">Option
														B</option>
													<option value="C" th:selected="${q.correctOption=='C'}">Option
														C</option>
													<option value="D" th:selected="${q.correctOption=='D'}">Option
														D</option>
												</select>
												<!-- DELETE QUESTION (selected later / future) -->
												<a th:href="@{/teacher/quiz/question/delete(questionId=${lesson.quiz.questions[0].questionId},lessonId=${lesson.lessonId})}"
													class="btn btn-outline"
													onclick="return confirm('Delete this question?')"> ðŸ—‘
													Delete Question </a>
											</div>
										</div>
										<div class="quiz-action-bar">
											<button class="btn btn-primary">ðŸ’¾ Save Quiz</button>

											<a th:href="@{/teacher/quiz/question/add(lessonId=${lesson.lessonId})}"
												class="btn btn-outline"> âž• Add Question </a>

											<!-- DELETE LESSON -->
											<a th:href="@{/teacher/lesson/delete(lessonId=${lesson.lessonId})}"
												class="btn btn-outline btn-danger"
												onclick="return confirm('Delete entire lesson?')"> ðŸ—‘
												Delete Lesson </a>
										</div>
									</form>

								</div>
							</div>
						</div>

					</div>
					<!-- ADD MODULE -->

					<form th:action="@{/teacher/module/add}" method="post" style="margin-top: 20px">
						<input type="hidden" name="courseId" th:value="${course.courseId}">
						<input name="title" placeholder="New module title" required>
						<button class="btn btn-primary">+ Add Module</button>
					</form>
				</div>


				<!-- PUBLISH -->
				<form th:action="@{/teacher-course/status}" method="post" th:if="${course.courseId != null}">
					<input type="hidden" name="courseId" th:value="${course.courseId}">
					<div class="card publish-card" th:if="${!#lists.isEmpty(course.modules)}">
						<h3>Publish</h3>
						<p>Your course will be reviewed before publishing. You can
							save it as a draft anytime.</p>
						<button type="submit" name="action" value="publish" class="btn btn-warning">Publish
							Course</button>
					</div>
					<!-- DRAFT -->
					<div class="action-bar">
						<button type="submit" name="action" value="draft" class="btn btn-outline">Save Draft</button>
					</div>
				</form>
			</div>




		</div>

	</main>
	<script>
		if (window.location.hash) {
			requestAnimationFrame(() => {
				const target = document.querySelector(window.location.hash);
				if (target) {
					target.scrollIntoView({ behavior: "smooth", block: "start" });
				}
			});
		}
	</script>
	<script>
		setTimeout(() => {
			document.querySelectorAll('.alert').forEach(a => a.remove());
		}, 3500);
	</script>
</body>

</html>