<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Teacher Dashboard</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<link rel="stylesheet" th:href="@{/css/teacher-css/teacher-sidebar.css}">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Poppins', sans-serif;
		}

		body {
			background: #f4f6f9;
		}


		.main-content {
			margin-left: 260px;
			padding: 20 30px;
			transition: margin-left 0.3s ease;
		}

		/* When sidebar is collapsed */
		body.sidebar-collapsed .main-content {
			margin-left: 80px;
		}


		.page-title {
			font-size: 28px;
			font-weight: 600;
			margin-top: 30px;
			margin-left: 20px;
		}

		/* ===== PAGE HEADER ===== */
		/* ===== Layout ===== */
		.dashboard {
			padding: 30px;
		}

		.section-title {
			margin: 30px 0 15px;
			font-size: 22px;
			font-weight: 600;
		}

		/* ===== DASHBOARD CARD ===== */
		.card {
			background: #ffffff;
			border-radius: 14px;
			padding: 22px;
			box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
		}

		/* ===== TABLE BASE ===== */
		table {
			width: 100%;
			border-collapse: separate;
			border-spacing: 0;
			font-size: 14.5px;
		}

		/* ===== TABLE HEADER ===== */
		thead th {
			position: sticky;
			top: 0;
			background: #f9fafb;
			color: #374151;
			font-weight: 600;
			padding: 14px 16px;
			border-bottom: 2px solid #e5e7eb;
			text-transform: uppercase;
			font-size: 12.5px;
			letter-spacing: 0.4px;
		}

		/* ===== TABLE BODY ===== */
		tbody tr {
			transition: background 0.2s ease, transform 0.15s ease;
		}

		tbody tr:nth-child(even) {
			background: #f9fafb;
		}

		tbody tr:hover {
			background: #eef2ff;
		}

		/* ===== TABLE CELLS ===== */
		td {
			padding: 14px 16px;
			vertical-align: middle;
			color: #374151;
		}

		/* ===== STUDENT NAME ===== */
		td strong {
			font-size: 15px;
			font-weight: 600;
		}

		td small {
			display: block;
			font-size: 12.5px;
			color: #6b7280;
			margin-top: 3px;
		}

		/* ===== STATUS TEXT ===== */
		.status-complete {
			color: #16a34a;
			font-weight: 600;
		}

		.status-progress {
			color: #9ca3af;
			font-style: italic;
		}

		/* ===== DROPDOWN (STATUS SELECT) ===== */
		select.form-select {
			padding: 6px 28px 6px 10px;
			border-radius: 8px;
			border: 1px solid #d1d5db;
			background-color: #ffffff;
			font-size: 13px;
			font-weight: 500;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		select.form-select:hover {
			border-color: #6366f1;
		}

		select.form-select:focus {
			outline: none;
			border-color: #6366f1;
			box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.25);
		}

		/* ===== EMPTY STATE ===== */
		tbody tr td[colspan] {
			text-align: center;
			padding: 30px;
			font-size: 14px;
			color: #6b7280;
		}

		/* ===== RESPONSIVE ===== */
		@media (max-width: 900px) {
			table {
				font-size: 13px;
			}

			td,
			th {
				padding: 12px 10px;
			}
		}

		/* ===== MAIN CONTENT SPACING FIX ===== */
		.main-content {
			margin-left: 260px;
			padding: 0;
			transition: margin-left 0.3s ease;
		}

		body.sidebar-collapsed .main-content {
			margin-left: 80px;
		}

		/* ===== DASHBOARD FULL WIDTH ===== */
		.dashboard.full-width {
			padding: 0;
			margin-top: 0;
		}

		/* ===== CARD SHOULD FILL PAGE ===== */
		.dashboard.full-width .card {
			border-radius: 0;
			box-shadow: none;
			padding: 24px 30px;
			min-height: calc(100vh - 90px);
			/* fills screen below header */
		}

		/* ===== REMOVE EXTRA TOP GAP ===== */
		.header-divider {
			margin-bottom: 0;
		}

		/* ===============================
   FEEDBACK PAGE UX UPGRADE
================================ */

		/* Remove unused spacing */
		.dashboard {
			padding: 0;
		}

		/* Course Feedback Card */
		.card {
			background: #ffffff;
			border-radius: 14px;
			padding: 26px 28px;
			margin-bottom: 26px;
			box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);
			transition: transform 0.2s ease, box-shadow 0.2s ease;
		}

		.card:hover {
			transform: translateY(-2px);
			box-shadow: 0 14px 36px rgba(0, 0, 0, 0.08);
		}

		/* Course Title */
		.card h5 {
			font-size: 20px;
			font-weight: 600;
			color: #111827;
			margin-bottom: 6px;
		}

		/* Average Rating */
		.card p {
			font-size: 14px;
			color: #6b7280;
			margin-bottom: 14px;
		}

		/* Divider */
		.card hr {
			border: none;
			height: 1px;
			background: #e5e7eb;
			margin: 18px 0;
		}

		/* Individual Feedback Block */
		.card .mb-3 {
			padding: 14px 16px;
			border-radius: 10px;
			background: #f9fafb;
			transition: background 0.2s ease;
		}

		.card .mb-3:hover {
			background: #eef2ff;
		}

		/* Student Name */
		.card strong {
			font-size: 15px;
			font-weight: 600;
			color: #1f2937;
		}

		/* Rating Stars */
		.card span {
			margin-left: 8px;
			font-size: 14px;
			font-weight: 500;
		}

		/* Comment */
		.card p.mb-1 {
			font-size: 14px;
			color: #374151;
			margin-top: 6px;
			line-height: 1.6;
		}

		/* Date */
		.card small {
			font-size: 12.5px;
			color: #9ca3af;
		}

		/* Empty State */
		.text-center.text-muted {
			padding: 40px;
			font-size: 15px;
		}

		.rating-badge {
			background: #fef3c7;
			color: #92400e;
			padding: 4px 10px;
			border-radius: 999px;
			font-size: 12.5px;
			font-weight: 600;
		}

		.card:first-child {
			margin-top: 0;
		}

		.course-card {
			transition: all 0.25s ease;
		}

		/* ===============================
   COURSE FILTER DROPDOWN – UX
================================ */

		/* Container */
		.course-filter {
			max-width: 360px;
			margin: 16px 0 28px;
			position: sticky;
			top: 12px;
			z-index: 5;
		}

		/* Label */
		.course-filter label {
			display: block;
			font-size: 13px;
			font-weight: 600;
			color: #374151;
			margin-bottom: 6px;
		}

		/* Select wrapper */
		.course-filter select {
			width: 100%;
			padding: 12px 44px 12px 14px;
			border-radius: 12px;
			border: 1px solid #d1d5db;
			background-color: #ffffff;
			font-size: 14px;
			font-weight: 500;
			color: #111827;
			cursor: pointer;
			appearance: none;
			background-image:
				linear-gradient(45deg, transparent 50%, #6b7280 50%),
				linear-gradient(135deg, #6b7280 50%, transparent 50%);
			background-position:
				calc(100% - 22px) 18px,
				calc(100% - 16px) 18px;
			background-size: 6px 6px;
			background-repeat: no-repeat;
			transition: all 0.25s ease;
		}

		/* Hover */
		.course-filter select:hover {
			border-color: #6366f1;
			background-color: #f9fafb;
		}

		/* Focus */
		.course-filter select:focus {
			outline: none;
			border-color: #6366f1;
			box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25);
		}

		/* Placeholder option */
		.course-filter option[value=""] {
			color: #9ca3af;
		}

		/* Mobile polish */
		@media (max-width: 768px) {
			.course-filter {
				max-width: 100%;
			}
		}

		/* Responsive polish */
		@media (max-width: 768px) {
			.card {
				padding: 20px;
			}

			.card h5 {
				font-size: 18px;
			}
		}
	</style>
</head>

<body class="sidebar-collapsed">
	<aside class="sidebar collapsed">
		<div class="sidebar-logo">
			<img th:src="@{/images/logo.png}" alt="EduPlatform Logo">
			<span class="logo-text">EduPlatform</span>
		</div>

		<nav class="sidebar-menu">
			<a th:href="@{/teacher-dashboard}"><i class="bi bi-speedometer2"></i><span> Dashboard </span></a>
			<a th:href="@{/teacher-course}"><i class="bi bi-journal-text"></i><span>Course Management</span></a>
			<a th:href="@{/teacher-creates-course}"><i class="bi bi-journal-plus"></i><span>Create Course</span></a>
			<a th:href="@{/teacher-exams}"><i class="bi bi-pencil-square"></i><span>Exams & Quizzes</span></a>
			<a th:href="@{/teacher-students}" class="active"><i class="bi bi-people"></i><span>Students</span></a>
			<a th:href="@{/teacher-communication}"><i class="bi bi-chat-dots"></i><span>Communication</span></a>
			<a th:href="@{/teacher-feedback}"><i class="bi bi-star"></i><span>Feedback & Ratings</span></a>
			<a th:href="@{/teacher-profile}"><i class="bi bi-gear"></i><span>Profile</span></a>
			<a th:href="@{/logout}" class="logout"><i class="bi bi-box-arrow-right"></i><span>Logout</span></a>
		</nav>
	</aside>

	<!-- ===== MAIN CONTENT ===== -->
	<main class="main-content">
		<!-- ===== TOP HEADER ===== -->
		<header class="top-header">
			<div class="header-left">
				<button class="sidebar-toggle" id="sidebarToggle">
					<i class="bi bi-list"></i>
				</button>

				<span class="page-title">Student Feedback & Ratings</span>
			</div>

			<div class="header-right">
				<div class="profile-trigger" id="profileToggle">
					<span th:text="${teacher.firstname + ' ' + teacher.lastname}">
						Dishank
					</span>
					<div class="avatar">
						<i class="bi bi-person-fill"></i>
					</div>
					<i class="bi bi-caret-down-fill"></i>
				</div>


				<div class="profile-dropdown" id="profileDropdown">
					<a th:href="@{/teacher-profile}">Profile</a>
					<a href="@{/logout}">Logout</a>
				</div>
			</div>
		</header>

		<hr class="header-divider">
		<div class="dashboard">
			<div class="course-filter">
				<label class="fw-semibold mb-1 d-block">Select Course</label>

				<select class="form-select" id="courseSelect">
					<option value="">-- Select a course --</option>
					<option value="all">Show All Courses</option>
					<option th:each="entry : ${courseFeedbackMap}" th:value="${entry.key.courseId}"
						th:text="${entry.key.title}">
					</option>
				</select>
			</div>
			<div th:each="entry : ${courseFeedbackMap}">

				<!-- Course Header -->
				<div class="card mb-4 p-3 course-card" th:attr="
        data-course-id=${entry.key.courseId},
        data-feedback-count=${entry.value.size()}
     " style="display:none;">
					<h5 class="fw-bold" th:text="${entry.key.title}">
						Course Name
					</h5>
					<p class="text-muted">
						Average Rating:
						⭐
						<span th:text="${#numbers.formatDecimal(
        avgRatingMap[entry.key.courseId], 1, 1)}">
						</span>
					</p>

					<hr>

					<!-- Feedback List -->
					<div th:each="f : ${entry.value}" class="mb-3">

						<strong th:text="${f.student.fullname}">
							Student Name
						</strong>

						<span class="rating-badge">
							⭐ <span th:text="${f.rating}"></span>/5
						</span>

						<p class="mb-1" th:text="${f.comment}">
							Feedback comment
						</p>

						<small class="text-muted" th:text="${#temporals.format(f.createdAt,'dd MMM yyyy')}">
							Date
						</small>

						<hr>
					</div>
				</div>

			</div>

			<div th:if="${courseFeedbackMap.isEmpty()}" class="text-muted text-center">
				No feedback received yet.
			</div>

		</div>
	</main>
	<script>

		const toggleBtn = document.getElementById("sidebarToggle");
		const sidebar = document.querySelector(".sidebar");

		const body = document.body;

		toggleBtn.addEventListener("click", () => {
			sidebar.classList.toggle("collapsed");
			body.classList.toggle("sidebar-collapsed");
		});


		const profileToggle = document.getElementById("profileToggle");
		const profileDropdown = document.getElementById("profileDropdown");

		if (profileToggle) {
			profileToggle.addEventListener("click", () => {
				profileDropdown.classList.toggle("show");
			});

			document.addEventListener("click", (e) => {
				if (!profileToggle.contains(e.target)) {
					profileDropdown.classList.remove("show");
				}
			});
		}
	</script>

</body>
<script>
	const courseSelect = document.getElementById("courseSelect");
	const cards = document.querySelectorAll(".course-card");

	function updateCards(selectedId) {
		cards.forEach(card => {
			if (selectedId === "all") {
				card.style.display = "block";
			} else if (card.dataset.courseId === selectedId) {
				card.style.display = "block";
			} else {
				card.style.display = "none";
			}
		});
	}

	// dropdown change
	courseSelect.addEventListener("change", function () {
		updateCards(this.value);
	});

	// ✅ optional: auto-select first course on page load
	window.addEventListener("DOMContentLoaded", () => {
		if (courseSelect.options.length > 2) { // skip placeholder + all
			courseSelect.selectedIndex = 2;
			updateCards(courseSelect.value);
		}
	});
</script>
<script>
	// Inject feedback count into dropdown options
	const courseOptions = document.querySelectorAll("#courseSelect option");
	const courseCards = document.querySelectorAll(".course-card");

	let totalFeedback = 0;

	courseOptions.forEach(option => {
		if (!option.value || option.value === "all") return;

		const card = Array.from(courseCards)
			.find(c => c.dataset.courseId === option.value);

		if (card) {
			const count = parseInt(card.dataset.feedbackCount || 0);
			totalFeedback += count;
			option.textContent += ` (${count} feedback${count !== 1 ? 's' : ''})`;
		}
	});

	// Update "All Courses" label
	const allOption = document.querySelector('#courseSelect option[value="all"]');
	if (allOption) {
		allOption.textContent = `All Courses (${totalFeedback} feedbacks)`;
	}
</script>

</html>