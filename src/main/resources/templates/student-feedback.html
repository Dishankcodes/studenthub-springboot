<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Student Dashboard | EduPlatform</title>

	<!-- Bootstrap Icons -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
	<link th:href="@{/css/student-style/student_sidebar.css}" rel="stylesheet">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
		}

		body {
			background: #fff;
			line-height: 1.6;
		}

		.main {
			margin-left: 240px;
			margin-top: 56px;
			padding: 20px;
			transition: 0.3s ease;
		}


		/* ===== CARD ===== */

		.feedback-card {
			max-width: 900px;
			margin: auto;
			background: #fff;
			border-radius: 16px;
			padding: 28px
		}

		.feedback-tabs {
			display: flex;
			margin-top: 20px;
			background: #f1f5f9;
			border-radius: 12px;
			padding: 6px
		}

		.tab-btn {
			flex: 1;
			border: none;
			background: none;
			padding: 12px;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px
		}

		.tab-btn.active {
			background: #1f1f2e;
			color: #fff
		}

		.tab-content {
			display: none;
			margin-top: 25px
		}

		.tab-content.active {
			display: block
		}

		.rating-stars {
			display: flex;
			gap: 8px;
			margin: 14px 0
		}

		.rating-stars i {
			font-size: 26px;
			cursor: pointer;
			color: #cbd5f5
		}

		.rating-stars i.active {
			color: #facc15
		}

		textarea {
			width: 100%;
			min-height: 130px;
			border-radius: 12px;
			border: 1px solid #d1d5db;
			padding: 14px;
			margin-top: 12px
		}

		.submit-btn {
			margin-top: 18px;
			background: #4f46e5;
			color: #fff;
			border: none;
			padding: 12px 22px;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			display: inline-flex;
			gap: 8px
		}

		.coming-soon {
			background: #fef3c7;
			border: 1px dashed #facc15;
			padding: 20px;
			border-radius: 14px;
			text-align: center;
			color: #92400e
		}

		.success-msg {
			background: #dcfce7;
			border: 1px solid #16a34a;
			color: #166534
		}

		/* ===============================
   STUDENT FEEDBACK UX POLISH
================================ */

		/* Headings */
		.feedback-card h2 {
			font-size: 24px;
			font-weight: 600;
			color: #111827;
		}

		.feedback-card h3 {
			font-size: 18px;
			font-weight: 600;
			margin-bottom: 10px;
		}

		/* Course / Instructor list item */
		.select-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 14px 16px;
			border-radius: 14px;
			border: 1px solid #e5e7eb;
			background: #ffffff;
			transition: all 0.2s ease;
			margin-top: 12px;
		}

		.select-item:hover {
			background: #eef2ff;
			border-color: #6366f1;
			transform: translateY(-1px);
		}

		.select-item strong {
			font-size: 15px;
			color: #111827;
		}

		.select-item small {
			color: #6b7280;
		}

		/* Feedback action button */
		.select-item .submit-btn {
			padding: 10px 16px;
			font-size: 13.5px;
			border-radius: 10px;
		}

		/* Tabs polish */
		.feedback-tabs {
			gap: 6px;
		}

		.tab-btn {
			transition: all 0.25s ease;
		}

		.tab-btn:not(.active):hover {
			background: #e5e7eb;
		}

		/* Rating block */
		.rating-stars {
			background: #f9fafb;
			padding: 14px;
			border-radius: 14px;
			justify-content: center;
		}

		/* Textarea polish */
		textarea {
			transition: border 0.2s ease, box-shadow 0.2s ease;
		}

		textarea:focus {
			outline: none;
			border-color: #6366f1;
			box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25);
		}

		/* Success / warning */
		.coming-soon {
			font-size: 14.5px;
		}

		.success-msg {
			font-weight: 600;
		}

		/* Instructor list scroll (scales well) */
		.instructor-list {
			max-height: 360px;
			overflow-y: auto;
			padding-right: 6px;
		}
	</style>
</head>

<body>

	<!-- ===== SIDEBAR ===== -->
	<div class="sidebar collapsed" id="sidebar">
		<button class="toggle-btn" id="toggle">
			<i class="bi bi-chevron-right"></i>
		</button>

		<div class="sidebar-brand">
			<a href="/student-dashboard">
				<img th:src="@{/images/logo.png}" class="platform-logo" alt="Logo">
			</a>
			<h2 class="platform-name">
				EduPlatform
			</h2>
		</div>

		<a th:href="@{/student-dashboard}"><i class="bi bi-speedometer2"></i><span>Dashboard</span></a>
		<a th:href="@{/student-course}"><i class="bi bi-search"></i><span>Explore Courses</span></a>
		<a th:href="@{/student-learning}"><i class="bi bi-book-half"></i><span>My Learning</span></a>
		<a th:href="@{/student-feedback}" class="active"><i class="bi bi-person-video3"></i><span>Instructor
				Overview</span></a>
		<a th:href="@{/student-news}"><i class="bi bi-megaphone"></i><span>Announcements</span></a>
		<a th:href="@{/student-notes}"><i class="bi bi-graph-up"></i><span>Notes</span></a>
		<a th:href="@{/student-chat}"><i class="bi bi-chat"></i><span>Doubts Chat</span></a>
		<a th:href="@{/student-internships}"><i class="bi bi-briefcase"></i><span>Internships</span></a>
		<a th:href="@{/student-profile}"><i class="bi bi-person-circle"></i><span>Profile</span></a>
		<a th:href="@{/student-login}"><i class="bi bi-box-arrow-right"></i><span>Logout</span></a>

	</div>

	<!-- ===== TOPBAR ===== -->
	<div class="student-topbar">
		<span class="page-title">Instructor Overview</span>
		<div class="topbar-right">
			<div class="notif">
				<a th:href="@{/student-notification}">
					<i class="bi bi-bell"></i>
					<span class="dot"></span> </a>
			</div>

			<div class="profile">
				<a th:href="@{/student-profile}" class="profile-link">
					<img src="/images/default.jpg" alt="Profile">
					<span class="student-name">Dishank</span>
				</a>
			</div>
		</div>


	</div>

	<div class="main">
		<div class="feedback-card">

			<h2>Share Your Experience</h2>
			<p style="color:#6b7280;margin-top:6px">
				Your feedback helps improve course quality and teaching standards.
			</p>

			<!-- ================= TABS ================= -->
			<div class="feedback-tabs">
				<button class="tab-btn active" data-tab="course">
					<i class="bi bi-journal-bookmark"></i> Course Feedback
				</button>

				<button class="tab-btn" data-tab="teacher">
					<i class="bi bi-person-video3"></i> Instructor Feedback
				</button>
			</div>

			<!-- ================= COURSE TAB ================= -->
			<div class="tab-content active" id="course">

				<!-- NO COURSE SELECTED -->
				<div th:if="${!courseSelected}" class="coming-soon">
					<h3>Select a course</h3>
					<p>You can give feedback only for completed courses.</p>

					<div th:if="${completedCourses != null}" th:each="c : ${completedCourses}" class="select-item">
						<div>
							<strong th:text="${c.title}"></strong><br>
							<small th:text="${c.teacher.firstname+' '+c.teacher.lastname}"></small>
						</div>
						<a class="submit-btn" th:href="@{/student-feedback/{id}(id=${c.courseId})}">
							<i class="bi bi-chat-dots-fill"></i> Give Feedback
						</a>
					</div>
				</div>

				<!-- COURSE SELECTED -->
				<div th:if="${courseSelected}">
					<h3 th:text="${course.title}"></h3>

					<div th:if="${!courseFeedbackSubmitted}">
						<form th:action="@{/student-feedback/{id}(id=${course.courseId})}" method="post">

							<!-- ‚≠ê HIDDEN RATING FIELD -->
							<input type="hidden" name="rating" id="ratingValue" value="0" />

							<div class="rating-stars" data-rating>
								<i class="bi bi-star-fill"></i>
								<i class="bi bi-star-fill"></i>
								<i class="bi bi-star-fill"></i>
								<i class="bi bi-star-fill"></i>
								<i class="bi bi-star-fill"></i>
							</div>

							<textarea name="comment" placeholder="What did you like? What can be improved?"
								required></textarea>

							<button class="submit-btn">
								<i class="bi bi-send-fill"></i> Submit Course Feedback
							</button>

						</form>
					</div>

					<div th:if="${courseFeedbackSubmitted}" class="coming-soon success-msg">
						‚úÖ Thanks for your course feedback!
					</div>
				</div>

			</div>

			<!-- ================= TEACHER TAB ================= -->
			<div class="tab-content" id="teacher">

				<!-- ===== LIST MODE ===== -->
				<div th:if="${feedbackMode == 'LIST'}">

					<h3>Select an Instructor</h3>

					<div th:if="${completedTeachers == null or completedTeachers.isEmpty()}" class="coming-soon">
						‚ùå You haven‚Äôt completed any course yet.
					</div>

					<div class="instructor-list">
						<div th:each="t : ${completedTeachers}" class="select-item">
							<div>
								<strong th:text="${t.firstname + ' ' + t.lastname}"></strong><br>
								<small th:text="${t.email}"></small>
							</div>
							<a class="submit-btn"
								th:href="@{/student-feedback/instructor/{id}(id=${t.teacherId},tab='teacher')}">
								Give Instructor Feedback
							</a>
						</div>
					</div>

				</div>

				<!-- ===== DIRECT MODE ===== -->
				<div th:if="${feedbackMode == 'DIRECT'}">

					<div th:if="${feedbackMode == 'DIRECT' and teacher != null}">
						<h3 th:text="${teacher.firstname + ' ' + teacher.lastname}"></h3>
					</div>

					<div th:if="${!canRateInstructor}" class="coming-soon">
						‚ùå You can rate this instructor only after completing their course.
					</div>

					<div th:if="${canRateInstructor == true}">

						<div th:if="${instructorFeedbackGiven}" class="coming-soon success-msg">
							‚úÖ You‚Äôve already rated this instructor.
						</div>

						<div th:if="${canRateInstructor == true and !instructorFeedbackGiven}">
							<form th:action="@{/student-feedback/instructor/{id}(id=${teacher.teacherId})}"
								method="post">

								<input type="hidden" name="rating" id="instructorRating" />

								<div class="rating-stars" data-instructor-rating>
									<i class="bi bi-star-fill"></i>
									<i class="bi bi-star-fill"></i>
									<i class="bi bi-star-fill"></i>
									<i class="bi bi-star-fill"></i>
									<i class="bi bi-star-fill"></i>
								</div>

								<textarea name="comment" placeholder="How was the instructor‚Äôs teaching?"
									required></textarea>

								<button class="submit-btn">
									<i class="bi bi-send-fill"></i> Submit Instructor Feedback
								</button>
							</form>
						</div>

					</div>

				</div>

			</div>

		</div>
	</div>

	<script>
		/* ===============================
		   ‚≠ê STAR RATING (COURSE)
		================================ */
		document.querySelectorAll("[data-rating] i").forEach((star, index, all) => {
			star.addEventListener("click", () => {
				all.forEach((s, i) =>
					s.classList.toggle("active", i <= index)
				);

				const ratingInput = document.getElementById("ratingValue");
				if (ratingInput) {
					ratingInput.value = index + 1;
				}
			});
		});

		/* ===============================
		   ‚≠ê STAR RATING (INSTRUCTOR)
		================================ */
		document.querySelectorAll("[data-instructor-rating] i")
			.forEach((star, index, all) => {
				star.addEventListener("click", () => {
					all.forEach((s, i) =>
						s.classList.toggle("active", i <= index)
					);

					const instructorInput = document.getElementById("instructorRating");
					if (instructorInput) {
						instructorInput.value = index + 1;
					}
				});
			});

		/* ===============================
		   üìë TAB HANDLING (COURSE / TEACHER)
		================================ */
		function activateTab(tabId) {
			document.querySelectorAll(".tab-btn")
				.forEach(b => b.classList.remove("active"));

			document.querySelectorAll(".tab-content")
				.forEach(c => c.classList.remove("active"));

			document.querySelector(`.tab-btn[data-tab="${tabId}"]`)
				?.classList.add("active");

			document.getElementById(tabId)
				?.classList.add("active");
		}

		// Click on tab
		document.querySelectorAll(".tab-btn").forEach(btn => {
			btn.addEventListener("click", () => {
				const tab = btn.dataset.tab;
				activateTab(tab);
				history.replaceState(null, "", "?tab=" + tab);
			});
		});

		// Auto-open tab from URL or default
		const params = new URLSearchParams(window.location.search);
		activateTab(params.get("tab") || "course");

		/* ===============================
		   üìå SIDEBAR (UNCHANGED)
		================================ */
		const sidebar = document.getElementById("sidebar");
		const toggle = document.getElementById("toggle");
		const icon = toggle.querySelector("i");

		toggle.addEventListener("click", () => {
			if (window.innerWidth <= 768) {
				sidebar.classList.toggle("mobile-show");
			} else {
				sidebar.classList.toggle("collapsed");
				icon.classList.toggle("bi-chevron-right");
				icon.classList.toggle("bi-chevron-left");
			}
		});
	</script>
</body>

</html>