<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Student Profile | EduPlatform</title>

	<!-- Bootstrap Icons -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
	<link th:href="@{/css/student-style/student_sidebar.css}" rel="stylesheet">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
		}

		body {
			background: #f4f7ff;
		}

		.main {
			margin-left: 240px;
			margin-top: 56px;
			padding: 20px;
			transition: 0.3s ease;
		}

		/* ===============================
   PROFILE CARD (CENTERED)
================================ */
		.profile-card {
			background: #ffffff;
			border-radius: 18px;
			padding: 32px 36px;
			max-width: 880px;
			margin: 40px auto;
			box-shadow: 0 15px 40px rgba(0, 0, 0, 0.08);
		}

		/* ===============================
   PROFILE HEADER
================================ */
		.profile-header {
			display: flex;
			align-items: center;
			gap: 26px;
			padding-bottom: 24px;
			border-bottom: 1px solid #eef1f7;
			margin-bottom: 28px;
		}

		.profile-header img {
			width: 120px;
			height: 120px;
			border-radius: 50%;
			object-fit: cover;
			border: 4px solid #e6ebff;
		}

		.profile-header h3 {
			font-size: 22px;
			font-weight: 600;
			color: #111827;
		}

		.profile-header p {
			margin-top: 4px;
			font-size: 14px;
			color: #6b7280;
		}

		/* ===============================
   PROFILE INFO GRID
================================ */
		.profile-info {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
			gap: 20px;
		}

		.info-box {
			background: #f8faff;
			padding: 16px 18px;
			border-radius: 12px;
			border: 1px solid #eef1f7;
			transition: 0.25s ease;
		}

		.info-box:hover {
			background: #eef2ff;
			border-color: #c7d2fe;
		}

		.info-box span {
			font-size: 12px;
			color: #6b7280;
			display: block;
			margin-bottom: 6px;
			text-transform: uppercase;
			letter-spacing: 0.4px;
		}

		.info-box strong {
			font-size: 15px;
			font-weight: 600;
			color: #111827;
			line-height: 1.4;
		}

		/* ===============================
   PROFILE ACTION BUTTONS
================================ */
		.profile-actions {
			margin-top: 32px;
			display: flex;
			gap: 16px;
		}

		.profile-actions button {
			border: none;
			outline: none;
			padding: 12px 22px;
			border-radius: 10px;
			font-size: 14px;
			font-weight: 500;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: 0.25s ease;
		}

		.btn-edit {
			background: #4f46e5;
			color: #ffffff;
		}

		.btn-edit:hover {
			background: #4338ca;
		}

		.btn-password {
			background: #e5e7eb;
			color: #111827;
		}

		.btn-password:hover {
			background: #d1d5db;
		}

		/* ===============================
   FORM ELEMENTS (EDIT MODE)
================================ */
		.profile-card input,
		.profile-card select,
		.profile-card textarea {
			width: 100%;
			padding: 10px 12px;
			border-radius: 10px;
			border: 1px solid #d1d5db;
			font-size: 14px;
			transition: 0.2s ease;
		}

		.profile-card input:focus,
		.profile-card select:focus,
		.profile-card textarea:focus {
			outline: none;
			border-color: #4f46e5;
			box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
		}

		/* Multi select */
		.profile-card select[multiple] {
			height: auto;
		}

		/* ===============================
   INLINE EDIT BLOCKS
================================ */
		.edit-block {
			grid-column: span 2;
			background: #f8faff;
			border: 1px dashed #c7d2fe;
			padding: 16px;
			border-radius: 14px;
		}

		/* ===============================
   ACTION CARDS (PASSWORD / EMAIL)
================================ */
		.action-card {
			margin-top: 20px;
			background: #ffffff;
			border-radius: 14px;
			padding: 18px 20px;
			border: 1px solid #eef1f7;
			box-shadow: 0 10px 24px rgba(0, 0, 0, 0.06);
		}

		.action-card h4 {
			font-size: 16px;
			font-weight: 600;
			margin-bottom: 12px;
		}

		.action-card button {
			margin-top: 10px;
		}

		/* Hide sections smoothly */
		.hidden {
			display: none;
		}

		/* ===============================
   BUTTON CONSISTENCY
================================ */
		.btn-edit,
		.btn-password {
			text-decoration: none;
			justify-content: center;
		}

		/* Cancel button */
		.btn-cancel {
			background: #e5e7eb;
			color: #111827;
		}

		.btn-cancel:hover {
			background: #d1d5db;
		}

		/* ===============================
   ERROR TEXT
================================ */
		.error {
			color: #dc2626;
			font-size: 13px;
			margin-top: 6px;
		}

		/* ===============================
   RESPONSIVE (MOBILE)
================================ */
		@media (max-width: 768px) {
			.profile-card {
				padding: 24px;
				margin: 20px;
			}

			.profile-header {
				flex-direction: column;
				text-align: center;
			}

			.profile-actions {
				flex-direction: column;
			}

			.profile-actions button {
				justify-content: center;
			}
		}

		html,
		body {
			height: 100%;
		}

		.sidebar {
			height: 100vh;
			position: fixed;
			left: 0;
			top: 0;
		}

		.profile-avatar {
			position: relative;
		}

		.profile-avatar img {
			width: 120px;
			height: 120px;
			border-radius: 50%;
			border: 4px solid #e6ebff;
			object-fit: cover;
		}

		/* Upload overlay */
		.avatar-upload {
			position: absolute;
			bottom: -10px;
			left: 50%;
			transform: translateX(-50%);
			display: flex;
			gap: 6px;
		}

		.avatar-upload label {
			background: #4f46e5;
			color: #fff;
			padding: 6px 8px;
			border-radius: 8px;
			cursor: pointer;
			font-size: 12px;
		}

		.avatar-upload button {
			background: #16a34a;
			color: #fff;
			border: none;
			padding: 6px 10px;
			border-radius: 8px;
			font-size: 12px;
			cursor: pointer;
		}

		/* ===============================
   FORM SPACING FIX
================================ */
		.action-card form {
			display: flex;
			flex-direction: column;
			gap: 14px;
		}

		.action-card input {
			padding: 12px 14px;
			border-radius: 10px;
			border: 1px solid #d1d5db;
			font-size: 14px;
			transition: 0.2s ease;
		}

		.action-card input:focus {
			outline: none;
			border-color: #4f46e5;
			box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
		}

		/* ===============================
   BUTTON SYSTEM
================================ */
		.btn {
			display: inline-flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
			padding: 12px 22px;
			border-radius: 10px;
			font-size: 14px;
			font-weight: 500;
			cursor: pointer;
			border: none;
			transition: 0.25s ease;
		}

		.btn-primary {
			background: #4f46e5;
			color: #ffffff;
		}

		.btn-primary:hover {
			background: #4338ca;
		}

		.btn-secondary {
			background: #e5e7eb;
			color: #111827;
		}

		.btn-secondary:hover {
			background: #d1d5db;
		}

		.action-card {
			animation: fadeSlide 0.3s ease;
		}

		@keyframes fadeSlide {
			from {
				opacity: 0;
				transform: translateY(8px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		/* ===============================
   ANCHOR BUTTON FIX
================================ */
		a.btn {
			text-decoration: none;
		}

		a.btn:hover,
		a.btn:focus {
			text-decoration: none;
		}
	</style>
</head>

<body>

	<!-- ===== SIDEBAR ===== -->
	<div class="sidebar collapsed" id="sidebar">
		<button class="toggle-btn" id="toggle">
			<i class="bi bi-chevron-right"></i>
		</button>

		<div class="sidebar-brand">
			<a href="/student-dashboard">
				<img th:src="@{/images/logo.png}" class="platform-logo" alt="Logo">
			</a>
			<h2 class="platform-name">
				EduPlatform
			</h2>
		</div>

		<a th:href="@{/student-dashboard}"><i class="bi bi-speedometer2"></i><span>Dashboard</span></a>
		<a th:href="@{/student-course}"><i class="bi bi-search"></i><span>Explore Courses</span></a>
		<a th:href="@{/student-learning}"><i class="bi bi-book-half"></i><span>My Learning</span></a>
		<a th:href="@{/student-feedback}"><i class="bi bi-person-video3"></i><span>Instructor Overview</span></a>
		<a th:href="@{/student-news}"><i class="bi bi-megaphone"></i><span>Announcements</span></a>
		<a th:href="@{/student-notes}"><i class="bi bi-graph-up"></i><span>Notes</span></a>
		<a th:href="@{/student-chat}"><i class="bi bi-chat"></i><span>Doubts Chat</span></a>
		<a th:href="@{/student-internships}"><i class="bi bi-briefcase"></i><span>Internships</span></a>
		<a th:href="@{/student-profile}" class="active"><i class="bi bi-person-circle"></i><span>Profile</span></a>
		<a th:href="@{/student-login}"><i class="bi bi-box-arrow-right"></i><span>Logout</span></a>

	</div>

	<!-- ===== TOPBAR ===== -->
	<div class="student-topbar">
		<span class="page-title">Student Profile</span>
		<div class="topbar-right">
			<div class="notif">
				<a th:href="@{/student-notification}">
					<i class="bi bi-bell"></i>
					<span class="dot"></span> </a>
			</div>

			<div class="profile">
				<a th:href="@{/student-profile}" class="profile-link">
					<img src="/images/default.jpg" alt="Profile">
					<span class="student-name" th:text="${student.fullname}">Student</span>
				</a>
			</div>
		</div>


	</div>
	<div class="main">

		<div class="profile-card">

			<!-- ================= PROFILE HEADER ================= -->
			<div class="profile-header">

				<!-- Avatar -->
				<div class="profile-avatar">
					<img th:src="${student.profileImage != null 
                    ? student.profileImage + '?v=' + #dates.createNow().time 
                    : '/images/default.jpg'}" alt="Profile Photo">

					<!-- Upload (only in edit mode) -->
					<form th:if="${editMode}" th:action="@{/student-profile/upload-image}" method="post"
						enctype="multipart/form-data" class="avatar-upload">

						<label title="Change photo">
							<i class="bi bi-camera-fill"></i>
							<input type="file" name="image" accept="image/*" hidden required>
						</label>

						<button type="submit">Update</button>
					</form>
				</div>

				<!-- Name + college -->
				<div>
					<h3 th:text="${student.fullname}">Student Name</h3>
					<p th:text="${student.college}">College</p>
				</div>

			</div>

			<!-- ================= VIEW MODE ================= -->
			<div th:if="${!editMode}" class="profile-info">

				<div class="info-box">
					<span>Full Name</span>
					<strong th:text="${student.fullname}"></strong>
				</div>

				<div class="info-box">
					<span>College</span>
					<strong th:text="${student.college}"></strong>
				</div>

				<div class="info-box">
					<span>Degree</span>
					<strong th:text="${student.degree}"></strong>
				</div>

				<div class="info-box">
					<span>Interests</span>
					<strong th:text="${student.interests}"></strong>
				</div>

			</div>

			<!-- ================= EDIT MODE ================= -->
			<form th:if="${editMode}" th:action="@{/student-profile/update}" method="post" class="edit-block">

				<div class="profile-info">

					<div>
						<span>Full Name</span>
						<input type="text" name="fullname" th:value="${student.fullname}" required>
					</div>

					<div>
						<span>College</span>
						<input type="text" name="college" th:value="${student.college}">
					</div>

					<div>
						<span>Degree</span>
						<select name="degree">
							<option value="BCA" th:selected="${student.degree=='BCA'}">BCA</option>
							<option value="MCA" th:selected="${student.degree=='MCA'}">MCA</option>
							<option value="BSCIT" th:selected="${student.degree=='BSCIT'}">BSc IT</option>
							<option value="IT" th:selected="${student.degree=='IT'}">IT</option>
						</select>
					</div>

					<div>
						<span>Interests</span>
						<select name="interests" multiple>
							<option value="Web Development">Web Development</option>
							<option value="Backend Development">Backend Development</option>
							<option value="Frontend Development">Frontend Development</option>
							<option value="Full Stack Development">Full Stack Development</option>
							<option value="DevOps">DevOps</option>
						</select>
					</div>

				</div>

				<div class="profile-actions">
					<button type="submit" class="btn-edit">
						<i class="bi bi-check-circle"></i> Save Changes
					</button>

					<a th:href="@{/student-profile}" class="btn btn-primary">
						Cancel
					</a>
				</div>

			</form>

			<!-- ================= ACTION BUTTONS ================= -->
			<div class="profile-actions">

				<a th:href="@{/student-profile(edit=true)}" th:if="${!editMode}" class="btn btn-primary">
					<i class="bi bi-pencil"></i> Edit Profile
				</a>

				<button class="btn-password" onclick="toggleCard('passwordCard')">
					<i class="bi bi-shield-lock"></i> Change Password
				</button>

				<button class="btn-password" onclick="toggleCard('emailCard')">
					<i class="bi bi-envelope"></i> Change Email
				</button>

			</div>

			<!-- ================= PASSWORD CARD ================= -->
			<div id="passwordCard" class="action-card hidden">
				<h4>Change Password</h4>

				<form th:action="@{/student-profile/change-password}" method="post">
					<input type="password" name="oldPassword" placeholder="Current Password" required>

					<input type="password" name="newPassword" placeholder="New Password" required>

					<input type="password" name="confirmPassword" placeholder="Confirm Password" required>

					<p th:if="${passwordError}" th:text="${passwordError}" class="error"></p>

					<button type="submit" class="btn btn-primary">
						Update Password
					</button>
				</form>
			</div>

			<!-- ================= EMAIL CARD ================= -->
			<div id="emailCard" class="action-card hidden">
				<h4>Change Email</h4>

				<form th:action="@{/student-profile/change-email}" method="post">
					<input type="email" name="oldEmail" placeholder="Current Email" required>

					<input type="password" name="password" placeholder="Password" required>

					<input type="email" name="newEmail" placeholder="New Email" required>

					<p th:if="${emailError}" th:text="${emailError}" class="error"></p>

					<button type="submit" class="btn btn-primary">
						Update Email
					</button>
				</form>
			</div>

		</div>

	</div>

	<!-- ===== SCRIPT ===== -->
	<script>
		const sidebar = document.getElementById("sidebar");
		const toggle = document.getElementById("toggle");
		const icon = toggle.querySelector("i");

		toggle.addEventListener("click", () => {
			if (window.innerWidth <= 768) {
				sidebar.classList.toggle("mobile-show");
			} else {
				sidebar.classList.toggle("collapsed");
				icon.classList.toggle("bi-chevron-right");
				icon.classList.toggle("bi-chevron-left");
			}
		});
	</script>
	<script>

		function toggleCard(id) {
			const card = document.getElementById(id);
			card.classList.toggle("hidden");
		}
	</script>
</body>

</html>